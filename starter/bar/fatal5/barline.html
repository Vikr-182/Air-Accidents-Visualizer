<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <style>
        .bar1 {
            fill: aqua;
        }

        .bar2 {
            fill: deepskyblue;
        }

        .bar3 {
            fill: steelblue;
        }

        .bar:hover {
            fill: orange;
        }

        .axis--x path {
            display: none;
        }

        .line {
            fill: none;
            stroke: royalblue;
            stroke-width: 3;
        }

        .dot {
            fill: royalblue;
            stroke: royalblue;
        }
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>

    <script>
        var dataset = [
        ["2000",1.68,22008658],
        ["2001",1.62,22264220],
        ["2002",1.59,20817389],
        ["2003",1.13,21282617],
        ['2004',1.35,23752616],
        ['2005',1.40,24228965],
        ["2006",0.97,24843166],
        ["2007",1.15,26016011],
        ["2008",1.02,25498093],
        ["2009",0.88,26120525],
        ["2010",0.91,29637587],
        ["2011",1.05,30564579],
        ["2012",0.58,30771268],
        ["2013",0.74,31116727],
        ["2014",0.56,32340000],
        ["2015",0.30,33272000],
        ["2016",0.46,34579000],
        ["2017",0.28,36348000],
        ["2018",0.37,37795000],
        ["2019",0.51,39016500],
        ];

        var margin = { top: 20, right: 40, bottom: 30, left: 40 },
            width = 960,
            height = 400;

        var xScale = d3.scaleBand()
            .rangeRound([0, width])
            .padding(0.1)
            .domain(dataset.map(function (d) {
                return d[0];
            }));
        yScale = d3.scaleLinear()
            .rangeRound([height, 0])
            .domain([0, d3.max(dataset, (function (d) {
                return d[2];
            }))]);

        y1Scale = d3.scaleLinear()
            .rangeRound([height, 0])
            .domain([0, d3.max(dataset, (function (d) {
                return d[1];
            }))]);


        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);

        var g = svg.append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // axis-x
        g.append("g")
            .attr("class", "axis axis--x")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(xScale));

        // axis-y
        g.append("g")
            .attr("class", "axis axis--y")
            .call(d3.axisLeft(yScale));

        // g.append("g")
        //     .attr("class", "axis axis--y")
        //     .call(d3.axisRight(y1Scale));





        var y_axis = d3.axisRight()
                .scale(y1Scale);

        svg.append("g")
            .attr("transform", "translate(995, 20)")
            .call(y_axis);


            

        var bar = g.selectAll("rect")
            .data(dataset)
            .enter().append("g");

        // bar chart
        bar.append("rect")
            .attr("x", function (d) { return xScale(d[0]); })
            .attr("y", function (d) { return yScale(d[2]); })
            .attr("width", xScale.bandwidth())
            .attr("height", function (d) { return height - yScale(d[2]); })
            .attr("class", function (d) {
                var s = "bar ";
                if (d[1] < 400) {
                    return s + "bar1";
                } else if (d[1] < 800) {
                    return s + "bar2";
                } else {
                    return s + "bar3";
                }
            });

        // labels on the bar chart
        bar.append("text")
            .attr("dy", "1.3em")
            .attr("x", function (d) { return -yScale(d[2])-35; })
            // 
            .attr("y", function (d) { return xScale(d[0]) + xScale.bandwidth() / 2; })
            .attr("text-anchor", "middle")
            .attr("transform","rotate(-90)")
            .attr("font-family", "sans-serif")
            .attr("font-size", "11px")
            .attr("fill", "black")
            .text(function (d) {
                return d[2];
            });

        // line chart
        var line = d3.line()
            .x(function (d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
            .y(function (d) { return y1Scale(d[1]); })
            .curve(d3.curveMonotoneX);

        bar.append("path")
            .attr("class", "line") // Assign a class for styling
            .attr("d", line(dataset)); // 11. Calls the line generator

        bar.append("circle") // Uses the enter().append() method
            .attr("class", "dot") // Assign a class for styling
            .attr("cx", function (d, i) { return xScale(d[0]) + xScale.bandwidth() / 2; })
            .attr("cy", function (d) { return y1Scale(d[1]); })
            .attr("r", 5);

    </script>
</body>

</html>